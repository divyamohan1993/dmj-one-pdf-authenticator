
# --- Admin credential rotation flags -----------------------------------------
# Rotate the admin login key on every deploy (recommended: keep =1)
DMJ_ROTATE_ADMIN_KEY="${DMJ_ROTATE_ADMIN_KEY:-1}"
# Also rotate the session HMAC so all existing admin sessions are forced to re-login
DMJ_FORCE_ADMIN_RELOGIN="${DMJ_FORCE_ADMIN_RELOGIN:-1}"

### --- Configs / Inputs -------------------------------------------------------
# DEV / PROD
DEPLOYMENT_MODE="${DEPLOYMENT_MODE:-DEV}"

DMJ_USER="dmjsvc"
LOG_DIR="/var/log/dmj"
STATE_DIR="/var/lib/dmj"
CONF_DIR="/etc/dmj"
INST_ENV="${CONF_DIR}/installer.env"

### ---------- Logging / Verbosity ----------
LOG_DIR="/var/log/dmj";
STATE_DIR="/var/lib/dmj";
CONF_DIR="/etc/dmj"

DMJ_VERBOSE="${DMJ_VERBOSE:-1}"
DMJ_VERBOSE_LOGS="${DMJ_VERBOSE_LOGS:-0}"

DMJ_ROOT_DOMAIN="${DMJ_ROOT_DOMAIN:-dmj.one}"
SIGNER_DOMAIN="${SIGNER_DOMAIN:-signer.${DMJ_ROOT_DOMAIN}}"

# Support/contact & Worker<->Signer header names (overrideable)
SUPPORT_EMAIL="${SUPPORT_EMAIL:-contact@${DMJ_ROOT_DOMAIN}}"
WORKER_HMAC_HEADER="${WORKER_HMAC_HEADER:-x-worker-hmac}"
WORKER_HMAC_TS_HEADER="${WORKER_HMAC_TS_HEADER:-x-worker-ts}"
WORKER_HMAC_NONCE_HEADER="${WORKER_HMAC_NONCE_HEADER:-x-worker-nonce}"

# WORKER_NAME="dmj-${INSTALLATION_ID}-docsign"
WORKER_NAME="document-signer"
WORKER_DIR="/opt/dmj/worker"
SIGNER_DIR="/opt/dmj/signer-vm"
NGINX_SITE="/etc/nginx/sites-available/dmj-signer"
NGINX_SITE_LINK="/etc/nginx/sites-enabled/dmj-signer"
# single, deterministic port (no file needed) 
SIGNER_FIXED_PORT="${SIGNER_FIXED_PORT:-18080}"

# --- PKI / OCSP endpoints (brand + URLs) -------------------------------------
PKI_DOMAIN="${PKI_DOMAIN:-pki.${DMJ_ROOT_DOMAIN}}"
OCSP_DOMAIN="${OCSP_DOMAIN:-ocsp.${DMJ_ROOT_DOMAIN}}"
TSA_DOMAIN="${TSA_DOMAIN:-tsa.dmj.one}"

OPT_DIR="/opt/dmj"
PKI_DIR="/opt/dmj/pki"
ROOT_DIR="${PKI_DIR}/root"
ICA_DIR="${PKI_DIR}/ica"
OCSP_DIR="${PKI_DIR}/ocsp"
PKI_PUB="${PKI_DIR}/pub"
TSA_DIR="${PKI_DIR}/tsa"

DL_DIR="${PKI_PUB}/dl"

# Branded subject names (official)
ROOT_CN="${ROOT_CN:-dmj.one Root CA R1}"
ICA_CN="${ICA_CN:-dmj.one Issuing CA R1}"
OCSP_CN="${OCSP_CN:-dmj.one OCSP Responder R1}"
SIGNER_CN="${SIGNER_CN:-dmj.one Signer}"
ORG_NAME="${ORG_NAME:-dmj.one Trust Services}"
COUNTRY="${COUNTRY:-IN}"
# TSA (RFC 3161)
TSA_CN="${TSA_CN:-dmj.one TSA R1}"

# Optional: control AIA/CRL scheme for certificates (keep http as default)
# use http (recommended). Only set to https if you KNOW clients will follow.
AIA_SCHEME="${AIA_SCHEME:-http}"
# use http (recommended). Only set to https if you KNOW clients will follow.
OCSP_AIA_SCHEME="${OCSP_AIA_SCHEME:-http}"

PKCS12_ALIAS="${PKCS12_ALIAS:-dmj-one}"

# ---- Shipping policy flags (pin end-user CA kit) ----
# Active CA on the server (may change in the future)
CA_SERIES="${CA_SERIES:-r1}"

# The end-user kit you ship. Pin this for years.
DMJ_SHIP_CA_SERIES="${DMJ_SHIP_CA_SERIES:-r1}"

# 0 = never touch Root by default
DMJ_REISSUE_ROOT="${DMJ_REISSUE_ROOT:-0}"

# 0 = never touch Issuing by default
DMJ_REISSUE_ICA="${DMJ_REISSUE_ICA:-0}"

# 0 = rarely needed
DMJ_REISSUE_OCSP="${DMJ_REISSUE_OCSP:-0}"

# 1 = rotate signer freely - dont - invalidates files
DMJ_REISSUE_LEAF="${DMJ_REISSUE_LEAF:-0}"
DMJ_REISSUE_TSA="${DMJ_REISSUE_TSA:-0}"

# 0 = never overwrite user Trust Kit ZIP
DMJ_REGEN_TRUST_KIT="${DMJ_REGEN_TRUST_KIT:-1}"
I_UNDERSTAND_THE_RISK="${I_UNDERSTAND_THE_RISK:-YES}"
CF_D1_DATABASE_ID="${CF_D1_DATABASE_ID:-}"